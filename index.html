<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elite Sports Team Org Structure</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--light-bg);
            color: var(--light-text-primary);
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        h1, h2, .font-header {
            font-family: 'Bebas Neue', sans-serif;
            letter-spacing: 0.05em;
        }

        :root {
            --light-bg: #FFFFFF;
            --light-bg-secondary: #F3F4F6;
            --light-text-primary: #222222;
            --light-text-secondary: #888888;
            --light-border: #E5E7EB;
            --light-accent1: #0052FF; /* Blue */
            --light-accent2: #6DD400; /* Green */
            --light-accent3: #FF7A00; /* Orange */
            --light-accent4: #FF3D00; /* Red */
            --light-accent5: #FFDA00; /* Yellow */
            --light-accent6: #B0B0B0; /* Light Gray */
            --light-node-bg: #E0E7FF;
            --light-node-bg-hover: #C7D2FE;
            --light-node-border: var(--light-accent1);
            --light-node-text: #1E1B4B;
            --light-node-dept-text: #047857;
        }

        .google-visualization-orgchart-node {
            border: 2px solid var(--light-node-border) !important;
            background-color: var(--light-node-bg) !important;
            border-radius: 8px !important;
            padding: 6px !important;
            box-shadow: 0 0px 0px rgba(0,0,0,0.1) !important;
            cursor: pointer !important;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        .google-visualization-orgchart-node:hover {
             background-color: var(--light-node-bg-hover) !important;
             border-color: var(--light-accent6) !important;
        }

        .dept-badge {
            display: inline-block;
            padding: 2px 8px !important;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            color: white;
            line-height: 1.2;
            /* white-space: nowrap; Removed to allow wrapping */
            margin-top: 4px;
        }
        .badge-coaching { background-color: var(--light-accent2); }
        .badge-medical { background-color: var(--light-accent4); }
        .badge-management { background-color: var(--light-accent3); }
        .badge-performance { background-color: var(--light-accent1); }
        .badge-default { background-color: var(--light-accent6); color: var(--light-text-primary); }

        .org-node-name {
             font-family: 'Bebas Neue', sans-serif;
             letter-spacing: 0.05em;
             font-size: 0.9rem;
             color: var(--light-node-text) !important;
             margin-bottom: 0;
        }

        .clickable-row { cursor: pointer; }
        .view-container { transition: opacity 0.5s ease-in-out; }
        .hidden-view { opacity: 0; height: 0; overflow: hidden; display: none; }
        .visible-view { opacity: 1; height: auto; display: block; }

        .modal { transition: opacity 0.3s ease-out, transform 0.3s ease-out; }
        .modal-hidden { opacity: 0; transform: scale(0.95); pointer-events: none; }
        .modal-visible { opacity: 1; transform: scale(1); pointer-events: auto; }
        #modal-description { max-height: 60vh; overflow-y: auto; }
        #modal-description ul { list-style: disc; margin-left: 1.5rem; margin-top: 0.5rem; margin-bottom: 0.5rem; }
        #modal-description li { margin-bottom: 0.25rem; }
        #modal-description strong { color: var(--light-accent1); }

    </style>
    </head>
<body class="min-h-screen flex flex-col">
    <div class="container mx-auto max-w-7xl flex-grow flex flex-col">

        <header class="p-4 md:px-6 md:py-4 flex justify-between items-center">
            <h1 class="text-3xl md:text-4xl font-header text-[--light-text-primary]">
                Elite Sports Team Organizational Structure
            </h1>
        </header>

        <div class="px-4 md:px-6 py-4 flex flex-wrap justify-start gap-4">
            <button id="show-chart-btn" class="inline-flex items-center font-semibold py-2 px-5 rounded-lg shadow transition duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-offset-2">
                 <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 mr-2">
                    <path d="M7 3a1 1 0 0 0-1 1v2.586a1 1 0 0 0 .293.707l5.414 5.414a1 1 0 0 0 .707.293H15a1 1 0 0 0 1-1v-2.586a1 1 0 0 0-.293-.707l-5.414-5.414A1 1 0 0 0 9.586 3H7ZM5 6.586a3 3 0 0 1-.879-2.121V4a3 3 0 0 1 3-3h2.586a3 3 0 0 1 2.121.879l5.414 5.414A3 3 0 0 1 18 10.414V13a3 3 0 0 1-3 3h-2.586a3 3 0 0 1-2.121-.879l-5.414-5.414A3 3 0 0 1 5 6.586Z" />
                    <path d="M3 7a1 1 0 0 1 1-1h2.586a1 1 0 0 1 .707.293l5.414 5.414a1 1 0 0 1 .293.707V15a1 1 0 0 1-1 1h-2.586a1 1 0 0 1-.707-.293l-5.414-5.414A1 1 0 0 1 3 8.586V7Z" />
                 </svg>
                Org Chart View
            </button>
            <button id="show-table-btn" class="inline-flex items-center font-semibold py-2 px-5 rounded-lg shadow transition duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-offset-2">
                 <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 mr-2">
                    <path fill-rule="evenodd" d="M4.25 3A2.25 2.25 0 0 0 2 5.25v9.5A2.25 2.25 0 0 0 4.25 17h11.5A2.25 2.25 0 0 0 18 14.75v-9.5A2.25 2.25 0 0 0 15.75 3H4.25ZM3.5 6.75v2.5h13v-2.5h-13Zm0 3.5v4.5A.75.75 0 0 0 4.25 15h11.5a.75.75 0 0 0 .75-.75v-4.5h-13Z" clip-rule="evenodd" />
                 </svg>
                Table View
            </button>
        </div>

        <main class="flex-grow p-4 md:px-6 md:py-6 overflow-auto">
            <div id="chart-view" class="view-container bg-[--light-bg-secondary] border border-[--light-border] rounded-lg p-4 overflow-auto">
                <div id="chart_div" class="w-full min-h-[500px]">
                     <div class="flex justify-center items-center h-full">
                         <p class="text-[--light-text-secondary]">Loading Chart...</p>
                     </div>
                </div>
            </div>

            <div id="table-view" class="view-container bg-[--light-bg-secondary] border border-[--light-border] rounded-lg p-4 overflow-x-auto">
                <table id="roles-table" class="min-w-full divide-y divide-[--light-border]">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-2 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Role</th>
                            <th scope="col" class="px-2 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Reports To</th>
                            <th scope="col" class="px-2 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Department</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-[--light-border]">
                    </tbody>
                </table>
            </div>
        </main>

    </div>

    <div id="role-modal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 modal modal-hidden px-4">
         <div class="bg-[--light-bg] rounded-lg shadow-xl p-6 max-w-lg w-full mx-auto border border-[--light-border]">
            <div class="flex justify-between items-center mb-4 pb-2 border-b border-[--light-border]">
                <h2 id="modal-title" class="text-2xl font-header text-[--light-accent1]">Role Details</h2>
                <button id="close-modal-btn" class="text-gray-400 hover:text-gray-700 text-3xl font-light leading-none">&times;</button>
            </div>
            <div id="modal-description" class="text-sm text-[--light-text-primary]"></div>
        </div>
    </div>

    <script type="text/javascript">
       const orgData = [
            { id: 1, name: "CEO / Team President", parentId: null, department: "Management", description: `<strong>Role:</strong> Chief Executive Officer (CEO) or Team President<br><br> <strong>Responsibilities:</strong> <ul> <li>Sets the overall strategic direction and vision for the organization.</li> <li>Oversees all business operations, including finance, marketing, and administration.</li> <li>Represents the team in league matters and major stakeholder interactions.</li> <li>Ultimately responsible for the organization's financial health and public image.</li> </ul> <strong>Key Interactions:</strong> Board of Directors, General Manager, Heads of Departments (Finance, Marketing, Operations).<br> <span class="text-xs italic text-gray-500"></span>` },
            { id: 2, name: "General Manager / Sporting Director", parentId: 1, department: "Management", description: `<strong>Role:</strong> General Manager (GM) or Sporting Director<br><br> <strong>Responsibilities:</strong> <ul> <li>Manages all aspects of the team's roster, including player acquisitions, trades, and contract negotiations.</li> <li>Hires and manages the Head Coach and often the heads of performance/medical departments.</li> <li>Oversees scouting departments (professional and amateur).</li> <li>Accountable for the team's competitive success and long-term athletic strategy.</li> </ul> <strong>Key Interactions:</strong> CEO/President, Head Coach, Scouting Department, Player Agents, Medical/Performance Heads.<br> <span class="text-xs italic text-gray-500">[cite: 260-262, 307]</span>` },
            { id: 3, name: "Operations Manager / Athletic Director", parentId: 1, department: "Management", description: `<strong>Role:</strong> Operations Manager or Athletic Director<br><br> <strong>Responsibilities:</strong> <ul> <li>Manages team logistics, including travel arrangements, accommodation, and scheduling.</li> <li>Oversees facility management (training grounds, stadium operations on game day).</li> <li>Manages equipment procurement and maintenance.</li> <li>Ensures compliance with league regulations regarding operations.</li> </ul> <strong>Key Interactions:</strong> CEO/President, GM, Head Coach, Travel Coordinators, Facility Staff, Equipment Managers.<br> <span class="text-xs italic text-gray-500"></span>` },
            { id: 4, name: "Finance Manager / CFO", parentId: 1, department: "Management", description: `<strong>Role:</strong> Finance Manager or Chief Financial Officer (CFO)<br><br> <strong>Responsibilities:</strong> <ul> <li>Develops and manages the team's budget.</li> <li>Oversees all financial reporting, accounting, and payroll.</li> <li>Manages cash flow and financial risk.</li> <li>Ensures financial compliance and strategy alignment with organizational goals.</li> </ul> <strong>Key Interactions:</strong> CEO/President, GM (for player budget), Department Heads.<br> <span class="text-xs italic text-gray-500"></span>` },
            { id: 5, name: "Marketing / PR Manager", parentId: 1, department: "Management", description: `<strong>Role:</strong> Marketing and Public Relations (PR) Manager<br><br> <strong>Responsibilities:</strong> <ul> <li>Develops and executes marketing strategies to build the team brand and engage fans.</li> <li>Manages public relations, media interactions, and team communications.</li> <li>Oversees social media presence, website content, and advertising campaigns.</li> <li>Manages sponsorship activation and relationships.</li> </ul> <strong>Key Interactions:</strong> CEO/President, GM, Players (for appearances), Media Outlets, Sponsors.<br> <span class="text-xs italic text-gray-500"></span>` },
            { id: 6, name: "Human Resources Manager", parentId: 1, department: "Management", description: `<strong>Role:</strong> Human Resources (HR) Manager<br><br> <strong>Responsibilities:</strong> <ul> <li>Manages recruitment, hiring, and onboarding for non-athletic staff.</li> <li>Oversees employee relations, benefits administration, and performance management.</li> <li>Ensures compliance with labor laws and regulations.</li> <li>Supports organizational development and workplace culture initiatives.</li> </ul> <strong>Key Interactions:</strong> CEO/President, Department Heads, All Staff.<br> <span class="text-xs italic text-gray-500"></span>` },
            { id: 7, name: "Head Coach", parentId: 2, department: "Coaching", description: `<strong>Role:</strong> Head Coach<br><br> <strong>Responsibilities:</strong> <ul> <li>Leads the entire coaching staff and directs all on-field activities.</li> <li>Develops game strategies, tactical plans, and training methodologies.</li> <li>Makes key in-game decisions and player selections.</li> <li>Motivates players and fosters team cohesion.</li> <li>Often collaborates closely with the GM on roster decisions.</li> </ul> <strong>Key Interactions:</strong> General Manager, Assistant Coaches, Specialist Coaches, Performance Analysts, Medical Staff, Players.<br> <span class="text-xs italic text-gray-500">[cite: 198-201, 307]</span>` },
            { id: 8, name: "Assistant Coach (Offense)", parentId: 7, department: "Coaching", description: `<strong>Role:</strong> Assistant Coach (e.g., Offensive Coordinator)<br><br> <strong>Responsibilities:</strong> <ul> <li>Assists the Head Coach with specific areas of game planning (e.g., offense).</li> <li>Conducts drills and provides technical instruction during training sessions.</li> <li>Contributes to player development and performance evaluation.</li> <li>May lead specific positional groups.</li> </ul> <strong>Key Interactions:</strong> Head Coach, Other Assistant Coaches, Players (especially positional group).<br> <span class="text-xs italic text-gray-500"></span>` },
            { id: 9, name: "Assistant Coach (Defense)", parentId: 7, department: "Coaching", description: `<strong>Role:</strong> Assistant Coach (e.g., Defensive Coordinator)<br><br> <strong>Responsibilities:</strong> <ul> <li>Assists the Head Coach with specific areas of game planning (e.g., defense).</li> <li>Conducts drills and provides technical instruction during training sessions.</li> <li>Contributes to player development and performance evaluation.</li> <li>May lead specific positional groups.</li> </ul> <strong>Key Interactions:</strong> Head Coach, Other Assistant Coaches, Players (especially positional group).<br> <span class="text-xs italic text-gray-500"></span>` },
            { id: 10, name: "Specialist Coach (e.g., Goalkeeping)", parentId: 7, department: "Coaching", description: `<strong>Role:</strong> Specialist Coach (e.g., Goalkeeping, Set Pieces, Strength & Conditioning)<br><br> <strong>Responsibilities:</strong> <ul> <li>Provides highly specialized technical and tactical instruction for specific skills or player positions.</li> <li>Designs and implements tailored training programs.</li> <li>Often works individually or with small groups of players.</li> </ul> <strong>Key Interactions:</strong> Head Coach, Assistant Coaches, Relevant Players.<br> <span class="text-xs italic text-gray-500"></span>` },
            { id: 11, name: "Head of Performance Analysis", parentId: 7, department: "Performance Analysis", description: `<strong>Role:</strong> Head of Performance Analysis<br><br> <strong>Responsibilities:</strong> <ul> <li>Leads the performance analysis department.</li> <li>Establishes workflows for data collection, analysis, and reporting.</li> <li>Ensures analytical insights are effectively communicated to coaching staff and players.</li> <li>Manages analysis tools and technologies.</li> <li>Oversees pre-match opposition analysis and post-match team review.</li> </ul> <strong>Key Interactions:</strong> Head Coach, Assistant Coaches, GM, Analysts, Data Scientists.<br> <span class="text-xs italic text-gray-500">[cite: 216-218, 315]</span>` },
            { id: 12, name: "Performance Analyst (Tactical)", parentId: 11, department: "Performance Analysis", description: `<strong>Role:</strong> Performance Analyst (Tactical Focus)<br><br> <strong>Responsibilities:</strong> <ul> <li>Analyzes video footage of team training and matches to assess tactical execution.</li> <li>Scouts upcoming opponents, identifying tactical patterns, strengths, and weaknesses.</li> <li>Creates detailed reports and video packages for coaches.</li> <li>May provide live analysis support during matches.</li> </ul> <strong>Key Interactions:</strong> Head of Performance Analysis, Coaches, Video Analysts.<br> <span class="text-xs italic text-gray-500"></span>` },
            { id: 13, name: "Data Scientist", parentId: 11, department: "Performance Analysis", description: `<strong>Role:</strong> Data Scientist<br><br> <strong>Responsibilities:</strong> <ul> <li>Applies advanced statistical methods, machine learning, and data modeling techniques to performance and tracking data.</li> <li>Develops predictive models for player performance or injury risk.</li> <li>Identifies deeper trends and insights not apparent through basic analysis.</li> <li>Manages large datasets and data infrastructure.</li> </ul> <strong>Key Interactions:</strong> Head of Performance Analysis, Performance Analysts, Sports Scientists.<br> <span class="text-xs italic text-gray-500"></span>` },
            { id: 14, name: "Video Analyst", parentId: 11, department: "Performance Analysis", description: `<strong>Role:</strong> Video Analyst<br><br> <strong>Responsibilities:</strong> <ul> <li>Films training sessions and matches from various angles.</li> <li>Codes (tags) key events and actions within the video footage.</li> <li>Manages the video database and ensures accessibility for coaches and analysts.</li> <li>Edits and produces video clips and presentations based on analyst/coach requests.</li> </ul> <strong>Key Interactions:</strong> Head of Performance Analysis, Performance Analysts, Coaches.<br> <span class="text-xs italic text-gray-500"></span>` },
             { id: 15, name: "Head of Medical & Sports Science", parentId: 7, department: "Medical & Sports Science", description: `<strong>Role:</strong> Head of Medical / Head of Sports Science / High Performance Manager<br><br> <strong>Responsibilities:</strong> <ul> <li>Oversees the entire medical and sports science provision for the team.</li> <li>Develops and implements strategies for injury prevention, rehabilitation, and performance optimization.</li> <li>Manages the medical and sports science staff (physicians, physios, scientists, etc.).</li> <li>Ensures integration of medical/science insights into the coaching process.</li> <li>Manages budgets and resources for the department.</li> </ul> <strong>Key Interactions:</strong> Head Coach, GM, Team Physician, Lead Physio, Lead Sports Scientist, Players.<br> <span class="text-xs italic text-gray-500">[cite: 236-238, 328]</span>` },
            { id: 16, name: "Team Physician", parentId: 15, department: "Medical & Sports Science", description: `<strong>Role:</strong> Team Physician / Doctor<br><br> <strong>Responsibilities:</strong> <ul> <li>Provides primary medical care and diagnoses illnesses and injuries.</li> <li>Oversees treatment plans and return-to-play protocols.</li> <li>Makes final decisions on player availability from a medical standpoint.</li> <li>Manages player medical records and ensures compliance with health regulations.</li> </ul> <strong>Key Interactions:</strong> Head of Medical, Physiotherapists, Players, Head Coach.<br> <span class="text-xs italic text-gray-500"></span>` },
            { id: 17, name: "Athletic Trainer / Physiotherapist", parentId: 15, department: "Medical & Sports Science", description: `<strong>Role:</strong> Athletic Trainer / Physiotherapist<br><br> <strong>Responsibilities:</strong> <ul> <li>Delivers hands-on treatment for injuries, including manual therapy and exercise prescription.</li> <li>Develops and supervises rehabilitation programs.</li> <li>Implements injury prevention strategies (e.g., screening, targeted exercises).</li> <li>Provides immediate care for injuries during training and matches.</li> </ul> <strong>Key Interactions:</strong> Head of Medical, Team Physician, Sports Scientists, Players, Coaches.<br> <span class="text-xs italic text-gray-500"></span>` },
            { id: 18, name: "Sports Scientist", parentId: 15, department: "Medical & Sports Science", description: `<strong>Role:</strong> Sports Scientist (Physiology / Biomechanics Focus)<br><br> <strong>Responsibilities:</strong> <ul> <li>Monitors player physical load, fatigue, and recovery using technologies (GPS, heart rate monitors, etc.).</li> <li>Conducts fitness testing and assesses physical performance markers.</li> <li>Provides data-driven recommendations to coaches on training intensity and periodization.</li> <li>Researches and implements best practices in sports science.</li> </ul> <strong>Key Interactions:</strong> Head of Sports Science, Physiotherapists, Strength & Conditioning Coaches, Performance Analysts, Coaches, Players.<br> <span class="text-xs italic text-gray-500"></span>` },
            { id: 19, name: "Sports Nutritionist / Dietitian", parentId: 15, department: "Medical & Sports Science", description: `<strong>Role:</strong> Sports Nutritionist / Dietitian<br><br> <strong>Responsibilities:</strong> <ul> <li>Develops individualized nutrition plans for players based on needs, goals, and training phase.</li> <li>Educates players on optimal dietary strategies for performance, recovery, and body composition.</li> <li>Advises on hydration protocols and appropriate supplement use.</li> <li>May oversee team meals and catering.</li> </ul> <strong>Key Interactions:</strong> Head of Medical/Science, Players, Team Physician, Chefs/Catering Staff.<br> <span class="text-xs italic text-gray-500"></span>` },
            { id: 20, name: "Sports Psychologist", parentId: 15, department: "Medical & Sports Science", description: `<strong>Role:</strong> Sports Psychologist / Mental Skills Coach<br><br> <strong>Responsibilities:</strong> <ul> <li>Provides psychological support and counseling to players and staff.</li> <li>Teaches mental skills techniques (e.g., goal setting, imagery, focus control, stress management).</li> <li>Assists with team dynamics, communication, and leadership development.</li> <li>Supports players during injury rehabilitation or periods of poor performance.</li> </ul> <strong>Key Interactions:</strong> Head of Medical/Science, Players, Coaches, Team Physician.<br> <span class="text-xs italic text-gray-500"></span>` }
        ];

        const activeBtnBg = 'var(--light-accent1)';
        const activeBtnHoverBg = 'var(--light-accent3)';
        const activeBtnRing = 'var(--light-accent1)';
        const activeBtnText = 'var(--light-bg)';

        const inactiveBtnBg = 'transparent';
        const inactiveBtnHoverBg = 'var(--light-bg-secondary)';
        const inactiveBtnRing = 'var(--light-accent6)';
        const inactiveBtnText = 'var(--light-text-secondary)';
        const inactiveBtnBorder = 'var(--light-accent6)';

        google.charts.load('current', {packages:['orgchart']});
        google.charts.setOnLoadCallback(drawChart);
        let googleChart = null;

        function getBadgeClass(department) {
            switch (department) {
                case 'Coaching': return 'badge-coaching';
                case 'Medical & Sports Science': return 'badge-medical';
                case 'Management': return 'badge-management';
                case 'Performance Analysis': return 'badge-performance';
                default: return 'badge-default';
            }
        }

        function drawChart() {
            const chartDiv = document.getElementById('chart_div');
            if (!chartDiv) return;

            try {
                const data = new google.visualization.DataTable();
                data.addColumn('string', 'Name');
                data.addColumn('string', 'Manager');
                data.addColumn('string', 'ToolTip');

                const chartData = orgData.map(role => {
                    const parentRole = orgData.find(p => p.id === role.parentId);
                    const parentName = parentRole ? parentRole.name : '';
                    const badgeClass = getBadgeClass(role.department);
                    const badgeHTML = role.department ? `<span class="dept-badge ${badgeClass}">${role.department}</span>` : '';
                    const displayHTML = `<div class="org-node-name">${role.name}</div>${badgeHTML}`;
                    return [{ v: role.name, f: displayHTML }, parentName, `Department: ${role.department || 'N/A'}`];
                });

                data.addRows(chartData);

                if (googleChart) {
                    googleChart.clearChart();
                }
                googleChart = new google.visualization.OrgChart(chartDiv);

                google.visualization.events.addListener(googleChart, 'select', selectHandler);

                function selectHandler() {
                    if (!googleChart) return;
                    const selection = googleChart.getSelection();
                    if (selection.length > 0) {
                        const selectedRowIndex = selection[0].row;
                        const roleName = data.getValue(selectedRowIndex, 0);
                        const role = orgData.find(r => r.name === roleName);
                        if (role) showModal(role);
                    }
                }

                googleChart.draw(data, {
                    allowHtml: true,
                    allowCollapse: true,
                    nodeClass: 'google-visualization-orgchart-node',
                    selectedNodeClass: 'google-visualization-orgchart-node-selected',
                    compactRows: true,
                    size: 'small'
                 });

                 const nodes = chartDiv.querySelectorAll('.google-visualization-orgchart-node');
                 nodes.forEach(node => {
                     node.setAttribute('tabindex', '0');
                     node.addEventListener('keydown', (e) => {
                         if (e.key === 'Enter' || e.key === ' ') {
                             const roleNameElement = node.querySelector('.org-node-name');
                             if (roleNameElement) {
                                 const roleName = roleNameElement.textContent;
                                  const role = orgData.find(r => r.name === roleName);
                                  if (role) showModal(role);
                             }
                         }
                     });
                 });
            } catch (e) {
                console.error("Error drawing Google Chart:", e);
                chartDiv.innerHTML = '<p class="text-red-500">Error loading chart.</p>';
            }
        }

        const tableBody = document.querySelector('#roles-table tbody');

        function populateTable() {
            if (!tableBody) return;
            tableBody.innerHTML = '';
            orgData.forEach(role => {
                const parentRole = orgData.find(p => p.id === role.parentId);
                const parentName = parentRole ? parentRole.name : 'N/A';
                const row = document.createElement('tr');
                row.classList.add('hover:bg-gray-100', 'clickable-row');
                row.setAttribute('data-role-id', role.id);

                const badgeClass = getBadgeClass(role.department);
                const badgeHTML = role.department ? `<span class="dept-badge ${badgeClass}">${role.department}</span>` : 'N/A';

                row.innerHTML = `
                    <td class="px-2 py-1 text-xs sm:px-6 sm:py-4 sm:text-sm font-medium text-gray-900">${role.name}</td>
                    <td class="px-2 py-1 text-xs sm:px-6 sm:py-4 sm:text-sm text-gray-500">${parentName}</td>
                    <td class="px-2 py-1 text-xs sm:px-6 sm:py-4 sm:text-sm text-gray-500">${badgeHTML}</td>
                `;
                row.addEventListener('click', () => { showModal(role); });
                tableBody.appendChild(row);
            });
        }

        const chartView = document.getElementById('chart-view');
        const tableView = document.getElementById('table-view');
        const showChartBtn = document.getElementById('show-chart-btn');
        const showTableBtn = document.getElementById('show-table-btn');

        function setActiveButton(activeBtn, inactiveBtn) {
            if (!activeBtn || !inactiveBtn) return;

            activeBtn.style.backgroundColor = activeBtnBg;
            activeBtn.style.color = activeBtnText;
            activeBtn.style.borderColor = 'transparent';
            activeBtn.classList.remove('border');
            activeBtn.onmouseover = () => activeBtn.style.backgroundColor = activeBtnHoverBg;
            activeBtn.onmouseout = () => activeBtn.style.backgroundColor = activeBtnBg;
            activeBtn.style.setProperty('--tw-ring-color', activeBtnRing);

            inactiveBtn.style.backgroundColor = inactiveBtnBg;
            inactiveBtn.style.color = inactiveBtnText;
            inactiveBtn.style.borderColor = inactiveBtnBorder;
            inactiveBtn.classList.add('border');
            inactiveBtn.onmouseover = () => inactiveBtn.style.backgroundColor = inactiveBtnHoverBg;
            inactiveBtn.onmouseout = () => inactiveBtn.style.backgroundColor = inactiveBtnBg;
            inactiveBtn.style.setProperty('--tw-ring-color', inactiveBtnRing);
        }

        if (showChartBtn) {
            showChartBtn.addEventListener('click', () => {
                if (chartView && tableView) {
                    chartView.classList.remove('hidden-view');
                    chartView.classList.add('visible-view');
                    tableView.classList.add('hidden-view');
                    tableView.classList.remove('visible-view');
                    setActiveButton(showChartBtn, showTableBtn);
                }
            });
        }

       if (showTableBtn) {
            showTableBtn.addEventListener('click', () => {
                 if (chartView && tableView) {
                    tableView.classList.remove('hidden-view');
                    tableView.classList.add('visible-view');
                    chartView.classList.add('hidden-view');
                    chartView.classList.remove('visible-view');
                    setActiveButton(showTableBtn, showChartBtn);
                 }
            });
        }

        const modal = document.getElementById('role-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalDescription = document.getElementById('modal-description');
        const closeModalBtn = document.getElementById('close-modal-btn');

        function showModal(role) {
            if (!role || !modal || !modalTitle || !modalDescription) return;
            modalTitle.textContent = role.name;
            modalDescription.innerHTML = role.description || 'No description available.';
            modal.classList.remove('modal-hidden');
            modal.classList.add('modal-visible');
            modalDescription.scrollTop = 0;
        }

        function hideModal() {
             if (!modal) return;
            modal.classList.add('modal-hidden');
            modal.classList.remove('modal-visible');
        }

        if(closeModalBtn) closeModalBtn.addEventListener('click', hideModal);
        if(modal) modal.addEventListener('click', (event) => { if (event.target === modal) hideModal(); });
        document.addEventListener('keydown', (event) => { if (event.key === 'Escape' && modal?.classList.contains('modal-visible')) hideModal(); });


        function initializeApp() {
            populateTable();

            const isMobile = window.innerWidth < 768;
            if (isMobile) {
                tableView?.classList.remove('hidden-view');
                tableView?.classList.add('visible-view');
                chartView?.classList.add('hidden-view');
                chartView?.classList.remove('visible-view');
                setActiveButton(showTableBtn, showChartBtn);
            } else {
                chartView?.classList.remove('hidden-view');
                chartView?.classList.add('visible-view');
                tableView?.classList.add('hidden-view');
                tableView?.classList.remove('visible-view');
                setActiveButton(showChartBtn, showTableBtn);
            }
        }

        document.addEventListener('DOMContentLoaded', initializeApp);

    </script>

</body>
</html>
